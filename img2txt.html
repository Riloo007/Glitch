<html>
<head>
  <title>Glitch Homepage</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/x-icon" href="logo.png">
</head>

<div id="global-page-header"></div>

<body>
  <div class="box">
    <div class="box-header">
      <h2>
        Image To Text
      </h2>
    </div>

    <div class="post">
      <div class="postHead">
        <table>
          <tr>
          <td><p style="text-align: left;">Image</p></td>
          <td><p style="text-align: right;"></p></td>
          </tr>
        </table>
      </div>

      <div>
        <table>
          <tr>
            <td>
              <p>
        Image: <input type="file" id="Img2TxtUpload" name="Img2TxtUpload">
        Mask:  <input type="file" id="mask" name="mask">
        <br>
        Use Mask? <input type="checkbox" id="useMask" name="useMask">
        Invert Mask? <input type="checkbox" id="InvertMask" name="InvertMask">
        <table>
          <tr>
            <td>
              <p>Font Weight</p>
            </td>
            <td>
              <input type="range" min="0" max="5" id="boldMultiplier" step=".01">
            </td>
          </tr>
          <tr>
            <td>
              Font Size
            </td>
            <td>
              <input type="range" min="0" max="20" id="fontSize">
            </td>
          </tr>
          <tr>
            <td>
              Color Brightness Subtraction
            </td>
            <td>
              <input type="range" min="0" max="200" id="colorSubtraction">
            </td>
          </tr>
          <tr>
            <td>
              Characters Wide / High
            </td>
            <td>
              <input type="number" min="1" max="200" id="charsWide">
            </td>
            <td>
              <input type="number" min="1" max="200" id="charsHigh">
            </td>
          </tr>
          <tr>
            <td>
              Spacing Vertical / Horizontal
            </td>
            <td>
              <input type="number" min="1" max="50" id="lineHeight">
            </td>
            <td>
              <input type="number" min="1" max="50" id="Spacing">
            </td>
          </tr>
          <tr>
            <td>
              <button onclick="document.getElementById('Output').innerHTML = ''; loadImage();">Load Image</button>
            </td>
            <td>
              <button onclick="document.getElementById('Output').innerHTML = '';">Clear</button>
            </td>
          </tr>
        </table>
        
        <img src="" style="display: none; width: 10px; height: auto;" id="imageDisplay">
        <img src="" style="display: none; width: 10px; height: auto;" id="maskDisplay">
        <canvas id="canvas" style="width: 40px;"></canvas>
        <canvas id="canvas2" style="width: 40px;"></canvas>
      </p>
            </td>
            <td>
              <p id="Output" style="font-size: 10px; font-family: 'Courier New', Courier, monospace; line-height: 9px; overflow: hidden;">
              </p>
            </td>
          </tr>
        </table>
      </div>
      
    </div>




  </div>
</body>

<script>

document.getElementById("Img2TxtUpload").onchange = function(evt) {
  var tgt = evt.target || window.event.srcElement,
      files = tgt.files;

  if(FileReader && files && files.length) {
    var fr = new FileReader();
    fr.onload = function () {
      document.getElementById("imageDisplay").src = fr.result;


    }
    fr.readAsDataURL(files[0]);

    //document.getElementById("imageDisplay").style = "display: block;";
  }
};

document.getElementById("mask").onchange = function(evt2) {
  var tgt = evt2.target || window.event.srcElement,
      files = tgt.files;

  if(FileReader && files && files.length) {
    var fr2 = new FileReader();
    fr2.onload = function () {
      document.getElementById("maskDisplay").src = fr2.result;
    }
    fr2.readAsDataURL(files[0]);

    //document.getElementById("imageDisplay").style = "display: block;";
  }
};

function loadImage() {
  var string = `
  Okay, that's gonna be easy. Life isn't as easy as we think it is. Nothing is easy. This is easy! Math is way too easy. Quickly and easily, just like that This is very easy, maybe, mathematically. Math is very easy as long as you understand it Logorithms should be very easy to me. It's not always that simple, but it often is. That is always easy if you can follow the steps. So once I make that connection, Life's pretty easy. It's so easy to get lost, and when you do, you're in trouble. We'll do 2, 3, and 4. Not easy! Mathematically, it might be a very simple question. Should this be easy? Maybe, it depends how good your math is. So, life is easy. Life always was easy. Can I take the log of both sides? Yeah, easy! It always seems easy when someone else is doing it. All math is easy, any questions? I can't explain it, it just works. How many got three points on that page? Not easy! It's frustrating to make a mistake, so try not to make a mistake. Really quite easy Have a little fun and solve them all You only have to know everything. Oh man, too many things to play with your mind. You say that's kind of easy, but it's not really. I'm literally afraid the class average is going to be 90%, and I'm going to make it as hard as I can. I don't do anything brilliant, cause it's really quite easy. It's easy to get very lost. Everything's easy in this chapter, that's why we're going so quickly. You've got to be sure of every little thing. It's not as easy as it appears to be So, hard question? Mm, maybe not I was going to say something, and this is what I was going to say: Hello, good morning! Just a little thinking, make sure you know. I'd like everyone to get 100%, but I'm not going to make it easy. Do this, and you'll never make a mistake. That's a big hole. You have a graphing calculator, it'll be easy for the most part. It will always be that way. Factoring is so easy, I just have to make sure it's right. The next thing here really isn't that challenging. I don't know, I could care less. You have a calculator, you should get it right. This is just mathematical fun Not all my stories are true, but that one's true. I will never pay another penny of interest. Okay, that's gonna be easy. Life isn't as easy as we think it is. Nothing is easy. This is easy! Math is way too easy. Quickly and easily, just like that This is very easy, maybe, mathematically. Math is very easy as long as you understand it Logorithms should be very easy to me. It's not always that simple, but it often is. That is always easy if you can follow the steps. So once I make that connection, Life's pretty easy. It's so easy to get lost, and when you do, you're in trouble. We'll do 2, 3, and 4. Not easy! Mathematically, it might be a very simple question. Should this be easy? Maybe, it depends how good your math is. So, life is easy. Life always was easy. Can I take the log of both sides? Yeah, easy! It always seems easy when someone else is doing it. All math is easy, any questions? I can't explain it, it just works. How many got three points on that page? Not easy! It's frustrating to make a mistake, so try not to make a mistake. Really quite easy Have a little fun and solve them all You only have to know everything. Oh man, too many things to play with your mind. You say that's kind of easy, but it's not really. I'm literally afraid the class average is going to be 90%, and I'm going to make it as hard as I can. I don't do anything brilliant, cause it's really quite easy. It's easy to get very lost. Everything's easy in this chapter, that's why we're going so quickly. You've got to be sure of every little thing. It's not as easy as it appears to be So, hard question? Mm, maybe not I was going to say something, and this is what I was going to say: Hello, good morning! Just a little thinking, make sure you know. I'd like everyone to get 100%, but I'm not going to make it easy. Do this, and you'll never make a mistake. That's a big hole. You have a graphing calculator, it'll be easy for the most part. It will always be that way. Factoring is so easy, I just have to make sure it's right. The next thing here really isn't that challenging. I don't know, I could care less. You have a calculator, you should get it right. This is just mathematical fun Not all my stories are true, but that one's true. I will never pay another penny of interest. Okay, that's gonna be easy. Life isn't as easy as we think it is. Nothing is easy. This is easy! Math is way too easy. Quickly and easily, just like that This is very easy, maybe, mathematically. Math is very easy as long as you understand it Logorithms should be very easy to me. It's not always that simple, but it often is. That is always easy if you can follow the steps. So once I make that connection, Life's pretty easy. It's so easy to get lost, and when you do, you're in trouble. We'll do 2, 3, and 4. Not easy! Mathematically, it might be a very simple question. Should this be easy? Maybe, it depends how good your math is. So, life is easy. Life always was easy. Can I take the log of both sides? Yeah, easy! It always seems easy when someone else is doing it. All math is easy, any questions? I can't explain it, it just works. How many got three points on that page? Not easy! It's frustrating to make a mistake, so try not to make a mistake. Really quite easy Have a little fun and solve them all You only have to know everything. Oh man, too many things to play with your mind. You say that's kind of easy, but it's not really. I'm literally afraid the class average is going to be 90%, and I'm going to make it as hard as I can. I don't do anything brilliant, cause it's really quite easy. It's easy to get very lost. Everything's easy in this chapter, that's why we're going so quickly. You've got to be sure of every little thing. It's not as easy as it appears to be So, hard question? Mm, maybe not I was going to say something, and this is what I was going to say: Hello, good morning! Just a little thinking, make sure you know. I'd like everyone to get 100%, but I'm not going to make it easy. Do this, and you'll never make a mistake. That's a big hole. You have a graphing calculator, it'll be easy for the most part. It will always be that way. Factoring is so easy, I just have to make sure it's right. The next thing here really isn't that challenging. I don't know, I could care less. You have a calculator, you should get it right. This is just mathematical fun Not all my stories are true, but that one's true. I will never pay another penny of interest. Okay, that's gonna be easy. Life isn't as easy as we think it is. Nothing is easy. This is easy! Math is way too easy. Quickly and easily, just like that This is very easy, maybe, mathematically. Math is very easy as long as you understand it Logorithms should be very easy to me. It's not always that simple, but it often is. That is always easy if you can follow the steps. So once I make that connection, Life's pretty easy. It's so easy to get lost, and when you do, you're in trouble. We'll do 2, 3, and 4. Not easy! Mathematically, it might be a very simple question. Should this be easy? Maybe, it depends how good your math is. So, life is easy. Life always was easy. Can I take the log of both sides? Yeah, easy! It always seems easy when someone else is doing it. All math is easy, any questions? I can't explain it, it just works. How many got three points on that page? Not easy! It's frustrating to make a mistake, so try not to make a mistake. Really quite easy Have a little fun and solve them all You only have to know everything. Oh man, too many things to play with your mind. You say that's kind of easy, but it's not really. I'm literally afraid the class average is going to be 90%, and I'm going to make it as hard as I can. I don't do anything brilliant, cause it's really quite easy. It's easy to get very lost. Everything's easy in this chapter, that's why we're going so quickly. You've got to be sure of every little thing. It's not as easy as it appears to be So, hard question? Mm, maybe not I was going to say something, and this is what I was going to say: Hello, good morning! Just a little thinking, make sure you know. I'd like everyone to get 100%, but I'm not going to make it easy. Do this, and you'll never make a mistake. That's a big hole. You have a graphing calculator, it'll be easy for the most part. It will always be that way. Factoring is so easy, I just have to make sure it's right. The next thing here really isn't that challenging. I don't know, I could care less. You have a calculator, you should get it right. This is just mathematical fun Not all my stories are true, but that one's true. I will never pay another penny of interest.

  `

    var img = document.getElementById('imageDisplay');
    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext("2d");
    ctx.getContextAttributes().willReadFrequently = true;
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img, 0, 0, img.width, img.height);

    var img2 = document.getElementById('maskDisplay');
    var canvas = document.getElementById('canvas2');
    var ctx2 = canvas.getContext("2d");
    ctx2.getContextAttributes().willReadFrequently = true;
    canvas2.width = img2.width;
    canvas2.height = img2.height;
    ctx2.drawImage(img2, 0, 0, img2.width, img2.height);

    console.log(ctx.getImageData(10,10,1,1).data);

    console.log(img.width, img.height);

    var Output = "";

    var charOff = 0;

    for(let y = 1 ; y < img.height; y += img.height / document.getElementById("charsHigh").value) {
      for(let x = 1 ; x < img.width; x += img.width / document.getElementById("charsWide").value) {

        console.log()
        console.log(charOff);

        //console.log(ctx.getImageData(10,10,1,1).data);
        var r = ctx.getImageData(x,y,1,1).data[1];
        var g = ctx.getImageData(x,y,1,1).data[2];
        var b = ctx.getImageData(x,y,1,1).data[3];

        var avg = (r + g + b) / 3;

        var CS = document.getElementById("colorSubtraction").value;

        var char;
        var Checkbool;
        if(document.getElementById("InvertMask").checked == true) {
          Checkbool = false;
        } else {
          Checkbool = true;
        }
        if(document.getElementById("useMask").checked == true) {
          console.log(ctx2.getImageData(x,y,1,1).data[1])
          if(Checkbool == true){
            if(ctx2.getImageData(x,y,1,1).data[1] < 128) {
            char = "&#160;";
          } else {
            char = string.charAt(charOff);
            charOff += 1
          }
          } else {
            if(ctx2.getImageData(x,y,1,1).data[1] > 128) {
            char = "&#160;";
          } else {
            char = string.charAt(charOff);
            charOff += 1
          }
          }
          
        } else {
          char = string.charAt(charOff);
          charOff += 1
        }
        

        Output += "<x style='font-weight:" + (avg * document.getElementById("boldMultiplier").value + 1) + "; font-size:" + document.getElementById("fontSize").value + "; color: rgb(" + (avg - CS) + "," + (avg - CS) + "," + (avg - CS) + ");" + " '>" + char + "</x>";


        `if(avg < 100 && avg > 0)
        {
          Output += "<p style='font-weight:" + toString(avg) + "'>" + "A" + "</p>";
          //document.write("A")
        }
        if(avg < 200 && avg > 100)
        {
          Output += "-";
          //document.write("B")
        }
        if(avg < 300 && avg > 200)
        {
          Output += " ";
          //document.write("C")
        }`

      }
      Output += "<br>";
      //document.write("<br>");
    }

    Output += "<style>" + `
        x {line-height:` + document.getElementById("lineHeight").value + "; letter-spacing:" + document.getElementById("Spacing").value + `}
      ` + "</style>";

    document.getElementById("Output").innerHTML = Output;
}
    //setInterval(CheckImage, 500);

</script>

<div id="global-page-footer"></div>

<script src="page.js"></script>
</html>