<html>
<head>
  <title>Terrain Generator</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/x-icon" href="logo.png">
</head>

<div id="global-page-header"></div>


<body>
  <div class="box">
    <div class="box-header">
      <h2>
        Terrain Generator
      </h2>
    </div>

    <!--<img src="logo.png" style="display: block; width: 200px; height: auto;" id="imageDisplay">-->

    <div class="post">
      <div class="postHead">
        <table>
          <tr>
          <td><div style="border: solid 2px black; border-radius: 5px;"><p style="text-align: left; cursor: pointer;" onclick="Generate(Math.round(document.getElementById('width').value), Math.round(document.getElementById('height').value), document.getElementById('scale').value);">Output</p></div></td>
          <td>Width: <input type="number" id="width" value="80"></td>
          <td>Height: <input type="number" id="height" value="10"></td>
          <td>Scale: <input type="number" id="scale" value="5"></td>
          </tr>
        </table>
      </div>
      <!--<canvas id="MainCanvas" width="60px" style="image-rendering: crisp-edges;"></canvas>-->
      <div style="text-align: center;">
        <table id="imgTable" style="table-layout: fixed;"></table>
      </div>
      
      
      <style>
        #imgTable tbody tr td {background-color: rgb(255, 255, 255); padding: 2.5px;}
        #imgTable {border-spacing: 0px; resize: none;}
      </style>
    </div>
    
  </div>
</body>

<div id="global-page-footer"></div>

<script>
/*    document.getElementById("Img2TxtUpload").onchange = function(evt) {
  var tgt = evt.target || window.event.srcElement,
      files = tgt.files;

  if(FileReader && files && files.length) {
    var fr = new FileReader();
    fr.onload = function () {
      document.getElementById("imageDisplay").src = fr.result;


    }
    fr.readAsDataURL(files[0]);

    //document.getElementById("imageDisplay").style = "display: block;";
  }
};*/

//var canvas = document.getElementById("MainCanvas");
//var ctx = canvas.getContext("2d");

//canvas.style.width = '300px'



function Generate(width, height, scale){
    //ctx.clearRect(0, 0, canvas.width, canvas.height);
    createGrid(width, height);

    //Generate terrain Shape
    var h = 0;
    var hc = 0;
    for(let x = 1; x < width; x++) {
      h += Math.random() * 0.07 * scale;
      hc += Math.random() * 0.1 * scale;
      y = Math.sin(h) + Math.sin(hc);
      y = y/3 * (height/3) + (height/2)

      yi = Math.round(y);

      for(y = yi; y - 1 < height; y++) {
        setPixel(x, y, 0, 0, 0);
      }
      for(y = yi; y < Math.round(Math.random() * 3) + 1 + yi; y++) {
        setPixel(x, y, 35, 120, 30);
      }

    }

    return

    //Colorize

    var yi = 0
    
    //var img = document.getElementById('imageDisplay');
    //ctx.clearRect(0, 0, canvas.width, canvas.height);
    //ctx.drawImage(img, 0, 0, img.width, img.height);
    ctx.getContextAttributes().willReadFrequently = true;

    for(var x = 1; x < canvas.width; x++) {
        for(var y = 1; y < canvas.height; y++) {
          
          if(img.getPixel(x, y) == new THREE.Vector3(0,0,0)) {
            var color = new THREE.Vector3(10, 200, 40);
            img.setPixel(x, y, color)
            //rh = Math.round(Math.random() * 10); drawLine(rh, 30, 30, 30, x, y);
          }
        }
    }

}

function createGrid(x, y) {
  tbl = document.getElementById('imgTable');
  tbl.innerHTML = '';

  for (let i = 0; i < y; i++) {
    const tr = tbl.insertRow();
    for (let j = 0; j < x; j++) {
        tr.insertCell();
    }
  }
}

function getPixel(x, y) {
  x--;y--;o=4;c=[0,0,0];
  cell = document.getElementById("imgTable").rows[y].cells[x].style.backgroundColor;

  for(j = 0; j < 3; j++) {
    var i = 0;
    var subs = "";
    while(subs != "," && subs != ")" && cell != "") {
      i++
      subs = cell.substr(o + i, 1);
    }
    if(cell == '') {r=0; g=0; b=0;}

    console.log(cell.substr(o, i));
    c[j] = parseInt(cell.substr(o, i))
    o += i + 1;
  }

  return c;
}

function setPixel(x, y, r, g, b) {
  x--;y--;
  document.getElementById("imgTable").rows[y].cells[x].style.backgroundColor = "rgb(" + r + "," + g + "," + b + ")";
}

</script>


<script src="page.js"></script>
</html>